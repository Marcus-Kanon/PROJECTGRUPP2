/*
 * 1. Installera Nuget: Newtonsoft.Json
 * Det används för att serialisera/deserialisera objekten som ska skickas/tas emot av API
 */

/*
 * 2. Lägg till Models/GameState.cs och Models/GamePiece.cs till projektet
 * Objekten som ska serialiseras/deserialiseras är av typen GameState.
 * Därför behöver Newtonsoft.Json ha klassen GameState för att veta hur objekten ska serialiseras/deserialiseras
 */

/*
 * 3. För att be vår API att skapa ett nytt spel åt oss behöver vi ansluta till dess adress på något sätt. T ex så här:
 */

//Results innehåller svaret vi får från vår API
string results = new WebClient().DownloadString("https://localhost:7223/api/creategame/create");

/*
* 4. Eftersom svaret vi får från vår API är ett serialiserat objekt, altså en Json-sträng. Så måste vi deserialisera det:
*/

//Här skapar vi ett objekt genom at deserialisera informationen våran API gav oss
GameState game = JsonConvert.DeserializeObject<GameState>(results);
joinplayerID = game.Player1.Id;


/*
 * 5. Våra två API:er: GetBoard och Move kräver att man anger parametrar.
 * Parametrar anger man i adressen när man ansluter API:n
 * Om vi ska kalla på GetBoard så behöver vi ange ett GameId och ett PlayerId:
 */

results = new WebClient().DownloadString("https://localhost:7223/api/GetBoard/" + game.GameId + "/" + joinplayerID);

//Deserialiserar svaret vi får
game = JsonConvert.DeserializeObject<GameState>(results);

 
//Väljer parametrar för Move API:n 
Console.WriteLine("Choose coordinates of piece to move: ");
Console.Write("current row (vertical): "); var oldY = Console.ReadLine();
Console.Write("current column (horizontal): "); var oldX = Console.ReadLine();
Console.Write("new row (vertical): "); var newY = Console.ReadLine();
Console.Write("new column (horizontal): "); var newX = Console.ReadLine();


//Ansluter Move API:n
results = new WebClient().DownloadString("https://localhost:7223/api/Move/" + $"{game.GameId}/{joinplayerID}/{oldX}/{oldY}/{newX}/{newY}");

//Move API:n returnerar ett string objekt som det är nu så det behövs ingen deserialisering
string message = results;

Console.Write("\nMove message: ");
Console.WriteLine(message);
Console.WriteLine("Press enter to continue...");
Console.ReadLine();
}
